<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="CoDaImpact">
<title>Getting started with CoDaImpact • CoDaImpact</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with CoDaImpact">
<meta property="og:description" content="CoDaImpact">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">CoDaImpact</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Vignette.html">Getting started with CoDaImpact</a>
    <a class="dropdown-item" href="../articles/paper_Share_Ratio.html">“Pairwise share-ratio interpretations of compositional regression models”</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/LukeCe/CoDaImpact/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Getting started with CoDaImpact</h1>
                        <h4 data-toc-skip class="author">Christine
Thomas-Agnan</h4>
                        <h4 data-toc-skip class="author">Lukas
Dargel</h4>
                        <h4 data-toc-skip class="author">Rodrigue
Nasr</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/LukeCe/CoDaImpact/blob/HEAD/vignettes/Vignette.Rmd" class="external-link"><code>vignettes/Vignette.Rmd</code></a></small>
      <div class="d-none name"><code>Vignette.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><strong>CoDaImpact</strong> is a package for the analysis of
covariate impacts in compositional regression models. It is designed to
work in conjunction with the <strong>compositions</strong> package. The
<strong>compositions</strong> package is used to fit a regression model
involving compositional variables and the <strong>CoDaImpact</strong>
package provides new functions to interpret the estimation results.</p>
<p>The interface between the two packages is implemented by the
<code><a href="../reference/ToSimplex.html">CoDaImpact::ToSimplex()</a></code> function which converts the usual
<em>lm</em> object into an object of class <em>lmCoDa</em>. This new
class is associated with new interpretation methods that make use of
elasticities and semi-elasticities (see Morais and Thomas-Agnan, 2021)
and share ratio elasticities (see Dargel and Thomas-Agnan, 2023). A
finite increments interpretation is also provided in the function
<code><a href="../reference/VariationTable.html">CoDaImpact::VariationTable()</a></code>. Finally, some visualization
tools are provided.</p>
<p>The Dargel and Thomas-Agnan (2023) paper is <a href="https://lukece.github.io/CoDaImpact/articles/paper_Share_Ratio.html">illustrated
by vignette</a> and all materials for reproducing the results in the
paper and the vignette <a href="https://github.com/LukeCe/paper_Share_Ratio" class="external-link">can be found on a
dedicated GitHub repository</a>.</p>
<p>The following three sections illustrate the use of the
<strong>CoDaImpact</strong> package for three classes of regression
models:</p>
<ol style="list-style-type: decimal">
<li>scalar on composition case: the response is scalar and at least one
of the explanatory variables is a composition,</li>
<li>composition on scalar case: the response is a composition and the
explanatory variables are scalar,</li>
<li>composition on composition case: the response is a composition and
at least one of the explanatory variables is a composition.</li>
</ol>
<p>&lt;! – Section 4 provides implementation details. –&gt; &lt;! – The
package contains three data sets used as examples:
<code>rice_yields</code>, <code>car_market</code>,
<code>elections</code>. –&gt;</p>
<p>The following code loads all the packages required for this vignette.
The <strong>CoDaImpact</strong> package has to be installed from GitHub
for now and should be released on CRAN later on.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remotes::install_github("LukeCe/CoDaImpact")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/LukeCe/CoDaImpact" class="external-link">CoDaImpact</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stat.boogaart.de/compositions/" class="external-link">compositions</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="scalar-on-composition-regression">Scalar on composition regression<a class="anchor" aria-label="anchor" href="#scalar-on-composition-regression"></a>
</h2>
<p>This case is illustrated using an example from Trinh et al. (2023)
studying the impact of climate change on rice yield in Vietnam.</p>
<div class="section level3">
<h3 id="rice-yield-data">Rice yield data<a class="anchor" aria-label="anchor" href="#rice-yield-data"></a>
</h3>
<p>The <code>rice_yields</code> dataset contains the rice production
“YIELD” in each province of Vietnam, between 1987 and 2016. The data on
rice yields originate from “International Rice Research Institute”. The
maximum daily temperature data originate from the database “Climate
Prediction Center (CPC)”, created by “National Oceanic and Atmospheric
Administration (NOAA)”. The temperatures have been interpolated over the
63 provinces using areal interpolation methods. For this illustration,
we group the temperatures in three classes <code>LOW</code> ([-6,25.1]),
<code>MEDIUM</code> ([25.1,35.4]) and <code>HIGH</code> ([35.4,45]). The
precipitation data come from the project “Asian
Precipitation-Highly-Resolved Observational Data Integration Towards
Evaluation (APHRODITE)”.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rice_yields</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           PROVINCE                                        REGION   </span></span>
<span><span class="co">##  ANGIANG      :  30   Central Highlands                      :180  </span></span>
<span><span class="co">##  BACGIANG     :  30   Mekong Delta                           :420  </span></span>
<span><span class="co">##  BACKAN       :  30   Midlands and Northern Mountainous Areas:390  </span></span>
<span><span class="co">##  BACLIEU      :  30   Northern and Coastal Central Region    :420  </span></span>
<span><span class="co">##  BACNINH      :  30   Red River Delta                        :330  </span></span>
<span><span class="co">##  BARIA-VUNGTAU:  30   Southeastern Area                      :150  </span></span>
<span><span class="co">##  (Other)      :1710                                                </span></span>
<span><span class="co">##       YEAR          YIELD       PRECIPITATION   </span></span>
<span><span class="co">##  Min.   :1987   Min.   :1.120   Min.   :0.1693  </span></span>
<span><span class="co">##  1st Qu.:1994   1st Qu.:3.094   1st Qu.:1.1656  </span></span>
<span><span class="co">##  Median :2002   Median :4.096   Median :1.4040  </span></span>
<span><span class="co">##  Mean   :2002   Mean   :4.077   Mean   :1.3824  </span></span>
<span><span class="co">##  3rd Qu.:2009   3rd Qu.:5.027   3rd Qu.:1.6411  </span></span>
<span><span class="co">##  Max.   :2016   Max.   :6.637   Max.   :3.7032  </span></span>
<span><span class="co">##                                                 </span></span>
<span><span class="co">##    TEMPERATURES.LOW    TEMPERATURES.MEDIUM    TEMPERATURES.HIGH  </span></span>
<span><span class="co">##  Min.   :0.0000003     Min.   :0.5150684     Min.   :0.00000020  </span></span>
<span><span class="co">##  1st Qu.:0.0027399     1st Qu.:0.6438356     1st Qu.:0.00273983  </span></span>
<span><span class="co">##  Median :0.1945206     Median :0.7657533     Median :0.02185802  </span></span>
<span><span class="co">##  Mean   :0.1704263     Mean   :0.7957867     Mean   :0.03378702  </span></span>
<span><span class="co">##  3rd Qu.:0.3095891     3rd Qu.:0.9726024     3rd Qu.:0.05205488  </span></span>
<span><span class="co">##  Max.   :0.4699453     Max.   :0.9999995     Max.   :0.25479457  </span></span>
<span><span class="co">## </span></span></code></pre>
<p>The following plot is a ternary diagram of maximum temperature
colored according to rice yield.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">whitered_pal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html" class="external-link">colorRampPalette</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beige"</span>,<span class="st">"orange"</span>,<span class="st">"red"</span>,<span class="st">"darkred"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">top100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rice_yields</span>, <span class="fl">250</span><span class="op">)</span></span>
<span><span class="va">whitered_col</span> <span class="op">&lt;-</span> <span class="fu">whitered_pal</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">top_100</span><span class="op">$</span><span class="va">YIELD</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'top_100' not found</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yield_top100</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="va">top_100</span><span class="op">$</span><span class="va">YIELD</span>,ties.method <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'top_100' not found</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ylcol_top100</span> <span class="op">&lt;-</span> <span class="va">whitered_col</span><span class="op">[</span><span class="va">yield_top100</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'whitered_col' not found</span></span></code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,ncol<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>,height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/compositions/man/acomp.html" class="external-link">acomp</a></span><span class="op">(</span><span class="va">top_100</span><span class="op">$</span><span class="va">TEMPERATURES</span><span class="op">)</span>,</span>
<span>     col <span class="op">=</span> <span class="va">ylcol_top100</span>,</span>
<span>     pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'top_100' not found</span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">legend_image</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/as.raster.html" class="external-link">as.raster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu">whitered_pal</span><span class="op">(</span><span class="fl">20</span><span class="op">)</span>, ncol<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">2</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,type <span class="op">=</span> <span class="st">'n'</span>, axes <span class="op">=</span> <span class="cn">F</span>,xlab <span class="op">=</span> <span class="st">''</span>, ylab <span class="op">=</span> <span class="st">''</span>, main <span class="op">=</span> <span class="st">'Rice yield'</span><span class="op">)</span></span>
<span><span class="va">yield_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">top_100</span><span class="op">$</span><span class="va">YIELD</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'top_100' not found</span></span></code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">yield_range</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">yield_range</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">yield_range</span><span class="op">)</span>, l <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'yield_range' not found</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">1.5</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,l<span class="op">=</span><span class="fl">5</span><span class="op">)</span>, labels <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">yield_range</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in eval(expr, envir, enclos): object 'yield_range' not found</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/rasterImage.html" class="external-link">rasterImage</a></span><span class="op">(</span><span class="va">legend_image</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Vignette_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="regression-step-with-the-compositions-package">Regression step with the <strong>compositions</strong> package<a class="anchor" aria-label="anchor" href="#regression-step-with-the-compositions-package"></a>
</h3>
<p>This model explains a scalar variable <code>YIELD</code> with a
combination of scalar and compositional variables. Before estimating, we
have to store our data in a data.frame in such a way that scalar
variables are column vectors and compositional variables are matrices.
In our dataset, the <code>TEMPERATURES</code> variable is already in the
matrix format.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">rice_yields</span>, <span class="va">class</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $PROVINCE</span></span>
<span><span class="co">## [1] "factor"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $REGION</span></span>
<span><span class="co">## [1] "factor"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $YEAR</span></span>
<span><span class="co">## [1] "numeric"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $YIELD</span></span>
<span><span class="co">## [1] "numeric"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $PRECIPITATION</span></span>
<span><span class="co">## [1] "numeric"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $TEMPERATURES</span></span>
<span><span class="co">## [1] "matrix" "array"</span></span></code></pre>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rice_yields</span><span class="op">$</span><span class="va">TEMPERATURES</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span> <span class="co">#LOW, MEDIUM, and HIGH, are grouped in TEMPERATURES</span></span></code></pre></div>
<pre><code><span><span class="co">##             LOW          MEDIUM            HIGH </span></span>
<span><span class="co">## 0.0000002999999 0.9616434547947 0.0383562452054</span></span></code></pre>
<p>We continue to fit a regression model with the tools provided by base
R and the <strong>compositions</strong> package, in particular, the
<code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> function and the <code><a href="https://rdrr.io/pkg/compositions/man/alr.html" class="external-link">alr()</a></code> transformation for
the <code>TEMPERATURES</code> variable.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_X_compo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">YIELD</span> <span class="op">~</span> <span class="va">PRECIPITATION</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/compositions/man/alr.html" class="external-link">alr</a></span><span class="op">(</span><span class="va">TEMPERATURES</span><span class="op">)</span>,data <span class="op">=</span> <span class="va">rice_yields</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fit_X_compo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "lm"</span></span></code></pre>
<p>In the next step the function <code><a href="../reference/ToSimplex.html">ToSimplex()</a></code> transforms the
above output into a “lmCoDa” class which serves as the interface between
the lm-output and the interpretation functions.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_X_compo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ToSimplex.html">ToSimplex</a></span><span class="op">(</span><span class="va">fit_X_compo</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fit_X_compo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "lmCoDa" "lm"</span></span></code></pre>
<p>The same can be achieved in a single step using the
<code><a href="../reference/lmCoDa.html">lmCoDa()</a></code> function.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_X_compo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lmCoDa.html">lmCoDa</a></span><span class="op">(</span><span class="va">YIELD</span> <span class="op">~</span> <span class="va">PRECIPITATION</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/pkg/compositions/man/alr.html" class="external-link">alr</a></span><span class="op">(</span><span class="va">TEMPERATURES</span><span class="op">)</span>,data <span class="op">=</span> <span class="va">rice_yields</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fit_X_compo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "lmCoDa" "lm"</span></span></code></pre>
<div class="section level6">
<h6 id="coef">coef<a class="anchor" aria-label="anchor" href="#coef"></a>
</h6>
<p>The estimated parameters can be retrieved by the <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code>
function. For a compositional explanatory variable the option
<code>space</code> allows choosing between the simplex version, the clr
version or the coordinate version of the parameters.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_X_compo</span>,space <span class="op">=</span> <span class="st">"simplex"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   YIELD</span></span>
<span><span class="co">## (Intercept)   3.5835270</span></span>
<span><span class="co">## PRECIPITATION 0.2528452</span></span>
<span><span class="co">## LOW           0.3338069</span></span>
<span><span class="co">## MEDIUM        0.3413303</span></span>
<span><span class="co">## HIGH          0.3248628</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_X_compo</span>,space <span class="op">=</span> <span class="st">"clr"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                      YIELD</span></span>
<span><span class="co">## (Intercept)    3.583526963</span></span>
<span><span class="co">## PRECIPITATION  0.252845153</span></span>
<span><span class="co">## LOW            0.001623843</span></span>
<span><span class="co">## MEDIUM         0.023911877</span></span>
<span><span class="co">## HIGH          -0.025535720</span></span></code></pre>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_X_compo</span><span class="op">)</span> <span class="co"># by default use the log-ratio of the estimation, here alr</span></span></code></pre></div>
<pre><code><span><span class="co">##                               YIELD</span></span>
<span><span class="co">## (Intercept)             3.583526963</span></span>
<span><span class="co">## PRECIPITATION           0.252845153</span></span>
<span><span class="co">## alr(TEMPERATURES)LOW    0.001623843</span></span>
<span><span class="co">## alr(TEMPERATURES)MEDIUM 0.023911877</span></span></code></pre>
</div>
<div class="section level6">
<h6 id="fitted">fitted<a class="anchor" aria-label="anchor" href="#fitted"></a>
</h6>
<p>The <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code> function retrieves the fitted values.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit_X_compo</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        1        2        3        4        5        6 </span></span>
<span><span class="co">## 3.924848 3.736444 3.948922 4.013668 3.871424 3.952286</span></span></code></pre>
</div>
<div class="section level6">
<h6 id="residuals">residuals<a class="anchor" aria-label="anchor" href="#residuals"></a>
</h6>
<p>The function <code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals()</a></code> retrieves the residuals.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">fit_X_compo</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          1          2          3          4          5          6 </span></span>
<span><span class="co">## -0.5188733 -0.7565444 -1.6756716 -1.6125383 -1.2580224 -1.3394688</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="interpretation-tools">Interpretation tools<a class="anchor" aria-label="anchor" href="#interpretation-tools"></a>
</h3>
<div class="section level4">
<h4 id="finite-increments-interpretation">Finite increments interpretation<a class="anchor" aria-label="anchor" href="#finite-increments-interpretation"></a>
</h4>
<p>Finite increments interpretation as in Muller et al. (2018) can be
obtained using outputs in coordinate space. For the case of scalar on
composition regression, more interpretations are found in Coenders and
Pawlovsky-Glahn (2020). The different formulations they propose
correspond to different parametrizations of the model and we illustrate
below their interpretation based on clr coordinates.</p>
<div class="section level5">
<h5 id="interpretation-with-ilr-coordinates">Interpretation with ilr coordinates<a class="anchor" aria-label="anchor" href="#interpretation-with-ilr-coordinates"></a>
</h5>
<p>Using the approach of Muller et al. (2018) we interpret an additive
increment for a specific ilr coordinate that corresponds to a so-called
principal balance. To use their interpretation we first need to
transform the parameters into the appropriate ilr space, which is
defined by the contrast matrix. The <code><a href="https://rdrr.io/pkg/compositions/man/ilrBase.html" class="external-link">ilrBase()</a></code> function
without further arguments leads to the principal balance of the last
component against all others.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">V_TEMP</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/compositions/man/ilrBase.html" class="external-link">ilrBase</a></span><span class="op">(</span>D <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">V_TEMP</span></span></code></pre></div>
<pre><code><span><span class="co">##         [,1]       [,2]</span></span>
<span><span class="co">## 1 -0.7071068 -0.4082483</span></span>
<span><span class="co">## 2  0.7071068 -0.4082483</span></span>
<span><span class="co">## 3  0.0000000  0.8164966</span></span></code></pre>
<p>We can use this contrast matrix and the parameters in clr space to
obtain the ilr parameters.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clr_TEMP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_X_compo</span>, space <span class="op">=</span> <span class="st">"clr"</span>, split <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="st">"alr(TEMPERATURES)"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">ilr_TEMP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">V_TEMP</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/compositions/man/matmult.html" class="external-link">%*%</a></span> <span class="va">clr_TEMP</span></span>
<span><span class="va">ilr_TEMP</span></span></code></pre></div>
<pre><code><span><span class="co">##            YIELD</span></span>
<span><span class="co">## [1,]  0.01576002</span></span>
<span><span class="co">## [2,] -0.03127474</span></span></code></pre>
<p>The interpretation is that an additive increment of one unit in the
second ilr coordinate leads to an expected decrease in the rice yield by
0.03 tonnes per hectare. This increment means that the ratio between
<code>HIGH</code> and the geometric mean of <code>LOW</code> and
<code>MEDIUM</code> is approximately multiplied by <span class="math inline">\(\exp(1/0.82)\sim 3.44,\)</span> where <span class="math inline">\(O.82\)</span> is the element <span class="math inline">\((3,2)\)</span> of the contrast matrix.</p>
<p>In terms of temperature distribution, the above increment implies
that the third component <code>HIGH</code> of the temperature
composition grows at the expense of the others (the geometric mean of
the other two) in a way that the ratio of <code>LOW</code> to
<code>MEDIUM</code> remains constant. This corresponds to a change in
the <code>TEMPERATURES</code> simplex in the direction of the vertex
<code>HIGH</code>. Changing for another vertex is simple by a
permutation of the rows of the contrast matrix.</p>
<p>This method only allows to evaluate the impacts of changing a
compositional covariate in the direction of a vertex. In Dargel and
Thomas-Agnan (2023) it is shown how the impact of more general changes
in explanatory compositions can be interpreted.</p>
</div>
<div class="section level5">
<h5 id="interpretation-with-clr-coordinates">Interpretation with clr coordinates<a class="anchor" aria-label="anchor" href="#interpretation-with-clr-coordinates"></a>
</h5>
<p>The clr parameter estimates for the temperatures are given by:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">clr_TEMP</span></span></code></pre></div>
<pre><code><span><span class="co">##               YIELD</span></span>
<span><span class="co">## LOW     0.001623843</span></span>
<span><span class="co">## MEDIUM  0.023911877</span></span>
<span><span class="co">## HIGH   -0.025535720</span></span></code></pre>
<p>We follow Coenders and Pawlovsky-Glahn (2020) but without changing
the base of the logarithm and the normalization constant. In these
conditions, the first clr parameter for the level <code>LOW</code> of
temperature is interpreted as the expected change of the response when
the ratio between <code>LOW</code> and the geometric mean of
<code>LOW</code>, <code>MEDIUM</code> and <code>HIGH</code> is
multiplied by <span class="math inline">\(\exp(1)\sim 2.7\)</span>. The
resulting change in expected yield is therefore an increase of <span class="math inline">\(0.0016\)</span> tons per hectare.</p>
</div>
<div class="section level5">
<h5 id="variation-scenario-in-the-simplex-space">Variation scenario in the simplex space<a class="anchor" aria-label="anchor" href="#variation-scenario-in-the-simplex-space"></a>
</h5>
<p>To evaluate the impact of a given compositional covariate, we create
scenarios of changes in its simplex space described by a linear equation
<span class="math inline">\(x(h)=x(0)\oplus h\odot u,\)</span> where
<span class="math inline">\(x(0)\)</span> is the initial point, <span class="math inline">\(h\)</span> is the signed-intensity of change and
<span class="math inline">\(u\)</span> is a vector of the simplex
defining the direction of change. We then compute the predicted value of
<span class="math inline">\(y(h)\)</span> corresponding to <span class="math inline">\(x(h)\)</span>.</p>
<p>We consider a change in the direction of the vertex “LOW” of the
variable “TEMPERATURE”, and we predict new values of the response
variable according to the change in percentage points of this
vertex.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/VariationScenario.html">VariationScenario</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_X_compo</span>,</span>
<span>  Xvar <span class="op">=</span> <span class="st">"TEMPERATURES"</span>,</span>
<span>  Xdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>  inc_size <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  n_steps <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  add_opposite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  obs<span class="op">=</span><span class="fl">43</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       YIELD           X.LOW        X.MEDIUM          X.HIGH</span></span>
<span><span class="co">## -5 3.819922 0.9989636850642 0.0000018748701 0.0010344400657</span></span>
<span><span class="co">## -4 3.855516 0.9963715150059 0.0000314423589 0.0035970426351</span></span>
<span><span class="co">## -3 3.891110 0.9870530721012 0.0005237290466 0.0124231988521</span></span>
<span><span class="co">## -2 3.926704 0.9498471187296 0.0084740730707 0.0416788081997</span></span>
<span><span class="co">## -1 3.962298 0.7674684242080 0.1151254523609 0.1174061234311</span></span>
<span><span class="co">## 0  3.997893 0.2465753931507 0.6219176838356 0.1315069230137</span></span>
<span><span class="co">## 1  4.033487 0.0220905961112 0.9368346502406 0.0410747536483</span></span>
<span><span class="co">## 2  4.069081 0.0013878377613 0.9896156353605 0.0089965268782</span></span>
<span><span class="co">## 3  4.104675 0.0000832426310 0.9980354895354 0.0018812678336</span></span>
<span><span class="co">## 4  4.140269 0.0000049585605 0.9996043543177 0.0003906871218</span></span>
<span><span class="co">## 5  4.175863 0.0000002949985 0.9999186719961 0.0000810330054</span></span></code></pre>
<p>For a good visual impression, it is better to use a smaller step size
and a larger number of steps. Below is the ternary diagram showing the
path in the simplex: the initial point is in black and the other ones
are colored according to the value of rice yield.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VS2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VariationScenario.html">VariationScenario</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_X_compo</span>,</span>
<span>  Xvar <span class="op">=</span> <span class="st">"TEMPERATURES"</span>,</span>
<span>  Xdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>  inc_size <span class="op">=</span> <span class="fl">.1</span>,</span>
<span>  n_steps <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  add_opposite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  obs<span class="op">=</span><span class="fl">43</span><span class="op">)</span></span>
<span></span>
<span><span class="va">yield_color</span> <span class="op">&lt;-</span> <span class="fu">whitered_pal</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">VS2</span><span class="op">$</span><span class="va">YIELD</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">yield_color</span> <span class="op">&lt;-</span> <span class="va">yield_color</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/rank.html" class="external-link">rank</a></span><span class="op">(</span><span class="va">VS2</span><span class="op">$</span><span class="va">YIELD</span>,ties.method <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/compositions/man/acomp.html" class="external-link">acomp</a></span><span class="op">(</span><span class="va">VS2</span><span class="op">$</span><span class="va">X</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">yield_color</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/compositions/man/acomp.html" class="external-link">acomp</a></span><span class="op">(</span><span class="va">VS2</span><span class="op">[</span><span class="st">"0"</span>, <span class="st">"X"</span><span class="op">]</span><span class="op">)</span>, add <span class="op">=</span> <span class="cn">TRUE</span>, pch <span class="op">=</span> <span class="fl">16</span><span class="op">)</span></span></code></pre></div>
<p><img src="Vignette_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
</div>
</div>
<div class="section level4">
<h4 id="infinitesimal-increments-interpretation">Infinitesimal increments interpretation<a class="anchor" aria-label="anchor" href="#infinitesimal-increments-interpretation"></a>
</h4>
<div class="section level5">
<h5 id="semi-elasticities">Semi-elasticities<a class="anchor" aria-label="anchor" href="#semi-elasticities"></a>
</h5>
<p>The use of semi-elasticities for the interpretation of compositional
covariates is described in Morais and Thomas-Agnan (2021). For a scalar
on composition model the <code><a href="../reference/Impacts.html">Impacts()</a></code> method computes the
semi-elasticities for all compositional covariates.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">RY_Impacts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Impacts.html">Impacts</a></span><span class="op">(</span><span class="va">fit_X_compo</span>, Xvar <span class="op">=</span> <span class="st">"TEMPERATURES"</span><span class="op">)</span></span>
<span><span class="va">RY_Impacts</span> <span class="co"># here, the semi-elasticity is computed for the variable TEMPERATURES </span></span></code></pre></div>
<pre><code><span><span class="co">##               YIELD</span></span>
<span><span class="co">## LOW     0.001623843</span></span>
<span><span class="co">## MEDIUM  0.023911877</span></span>
<span><span class="co">## HIGH   -0.025535720</span></span></code></pre>
</div>
<div class="section level5">
<h5 id="increments-approach">Increments approach<a class="anchor" aria-label="anchor" href="#increments-approach"></a>
</h5>
<p>Dargel and Thomas-Agnan (2023) use semi-elasticities to interpret
infinitesimal changes due to variation scenarios. The function
<code>VariationTable</code> computes the impact of incremental changes
in covariates on the response variable. The covariate increments,
corresponding to linear changes in the simplex, are indexed by a
direction vector and a signed intensity parameter <code>inc_size</code>
and are specific to a given observation. Two cases are illustrated below
with a direction pointing to a vertex of the simplex and a general
direction. For the vertex direction, the <code>inc_rate</code> is
related to the <code>inc_size</code> parameter and measures the relative
change of the share corresponding to this vertex.</p>
<div class="section level6">
<h6 id="infinitesimal-increment-direction-pointing-to-a-vertex">Infinitesimal increment: direction pointing to a vertex<a class="anchor" aria-label="anchor" href="#infinitesimal-increment-direction-pointing-to-a-vertex"></a>
</h6>
<p>The direction pointing to a vertex corresponds to the increments
considered by Muller et al. (2018). For example, we can measure the
change caused by increasing the HIGH share of the
<code>TEMPERATURES</code> variable by <span class="math inline">\(5\%\)</span>, assuming that the ratio between the
other two components remains constant, using the function
<code><a href="../reference/VariationTable.html">VariationTable()</a></code>.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/VariationTable.html">VariationTable</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_X_compo</span>,</span>
<span>  obs      <span class="op">=</span>  <span class="fl">1</span>,             <span class="co"># indicator of the observation (1 is default)</span></span>
<span>  Xvar     <span class="op">=</span> <span class="st">"TEMPERATURES"</span>, <span class="co"># covariate for which the impact is computed</span></span>
<span>  Xdir     <span class="op">=</span> <span class="st">'HIGH'</span>,         <span class="co"># vertex in the covariate simplex </span></span>
<span>  inc_rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>           <span class="co"># signed intensity </span></span></code></pre></div>
<pre><code><span><span class="co">##                           YIELD</span></span>
<span><span class="co">## Initial value       3.924848006</span></span>
<span><span class="co">## New value           3.919636938</span></span>
<span><span class="co">## Semi elasticity    -0.031274742</span></span>
<span><span class="co">## Variation in %     -0.132771206</span></span>
<span><span class="co">## Variation in units -0.005211068</span></span></code></pre>
<p>The interpretation of this result is as follows: a <span class="math inline">\(5\%\)</span> change of the <code>HIGH</code> share
assuming the ratio between the <code>LOW</code> and the
<code>MEDIUM</code> share remains constant will result in a <span class="math inline">\(-0.0052\)</span> unit change in
<code>YIELD</code>.</p>
</div>
<div class="section level6">
<h6 id="infinitesimal-increment-general-direction">Infinitesimal increment: general direction<a class="anchor" aria-label="anchor" href="#infinitesimal-increment-general-direction"></a>
</h6>
<p>Let us now consider changing the covariate in the direction <span class="math inline">\((0.2,0.55,0.25)\)</span>, with an increment size
of <span class="math inline">\(0.05\)</span>. Note that this direction
vector will be normalized before being used within the function, and
will later be given as output in attributes.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_X_compo.varTab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VariationTable.html">VariationTable</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_X_compo</span>,</span>
<span>  obs      <span class="op">=</span> <span class="fl">10</span>,               <span class="co"># indicator of the observation</span></span>
<span>  Xvar     <span class="op">=</span> <span class="st">"TEMPERATURES"</span>,   <span class="co"># covariate for which the impact is computed</span></span>
<span>  Xdir     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>,<span class="fl">0.55</span>,<span class="fl">0.25</span><span class="op">)</span>, <span class="co"># general direction in the covariate simplex</span></span>
<span>  inc_size <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span>             <span class="co"># signed intensity</span></span>
<span></span>
<span><span class="va">fit_X_compo.varTab</span></span></code></pre></div>
<pre><code><span><span class="co">##                          YIELD</span></span>
<span><span class="co">## Initial value      4.010224763</span></span>
<span><span class="co">## New value          4.015157689</span></span>
<span><span class="co">## Semi elasticity    0.024601746</span></span>
<span><span class="co">## Variation in %     0.123008728</span></span>
<span><span class="co">## Variation in units 0.004932926</span></span></code></pre>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">fit_X_compo.varTab</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $names</span></span>
<span><span class="co">## [1] "YIELD"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $class</span></span>
<span><span class="co">## [1] "data.frame"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $row.names</span></span>
<span><span class="co">## [1] "Initial value"      "New value"          "Semi elasticity"   </span></span>
<span><span class="co">## [4] "Variation in %"     "Variation in units"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`X(0)`</span></span>
<span><span class="co">##               LOW            MEDIUM              HIGH </span></span>
<span><span class="co">## "0.0000002999999" "0.9506845561646" "0.0493151438356" </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "acomp"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`X(h)`</span></span>
<span><span class="co">## [1] 0.0000002805874 0.9531436237124 0.0468560957002</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Xdir</span></span>
<span><span class="co">## [1] 0.1616218 0.6208904 0.2174878</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inc_size</span></span>
<span><span class="co">## [1] 0.05</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inc_rates</span></span>
<span><span class="co">## [1] -0.064708144  0.002586628 -0.049863955</span></span></code></pre>
<p>The move between the temperature share vector of <span class="math inline">\((0.0000002999999, 0.9506845561646,
0.0493151438356)\)</span> to <span class="math inline">\((0.0000002805874, 0.9531436237124,
0.0468560957002)\)</span> results in an increase of the
<code>YIELD</code> by <span class="math inline">\(0.004932926\)</span>
units. Note that the Aitchison distance between these two points is
equal to the increment size <span class="math inline">\(0.05\)</span>.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="composition-on-scalar-regression">Composition on scalar regression<a class="anchor" aria-label="anchor" href="#composition-on-scalar-regression"></a>
</h2>
<p>This case is illustrated using an example from Morais et al. (2018)
studying the impact of some socio-economic variables on the market
shares in each of the five market segments A, B, C, D and E.</p>
<div class="section level3">
<h3 id="car-market-data">Car market data<a class="anchor" aria-label="anchor" href="#car-market-data"></a>
</h3>
<p>This dataset shows monthly data on the French automobile market
between 2003 and 2015. The market is divided into 5 main segments
(<code>SEG_A</code> to <code>SEG_E</code>), according to the size of the
vehicle chassis. Apart from data on market shares, we have four
classical variables, such as <code>HOUSEHOLD_EXPENDITURE</code>, gross
domestic product (<code>GDP</code>), the average national price of
diesel fuel (<code>GAS_PRICE</code>), and
<code>SCRAPPING_SUBSIDY</code>. We also have the <code>DATE</code>,
generally the beginning of each month in which the sale has taken
place.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">car_market</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       DATE                SEG_A             SEG_B            SEG_C       </span></span>
<span><span class="co">##  Min.   :2003-01-01   Min.   :0.05178   Min.   :0.3051   Min.   :0.2959  </span></span>
<span><span class="co">##  1st Qu.:2006-02-22   1st Qu.:0.06979   1st Qu.:0.3721   1st Qu.:0.3398  </span></span>
<span><span class="co">##  Median :2009-04-16   Median :0.07841   Median :0.3909   Median :0.3593  </span></span>
<span><span class="co">##  Mean   :2009-04-16   Mean   :0.08737   Mean   :0.3910   Mean   :0.3654  </span></span>
<span><span class="co">##  3rd Qu.:2012-06-08   3rd Qu.:0.09893   3rd Qu.:0.4125   3rd Qu.:0.3883  </span></span>
<span><span class="co">##  Max.   :2015-08-01   Max.   :0.16036   Max.   :0.4576   Max.   :0.4484  </span></span>
<span><span class="co">##      SEG_D             SEG_E              GDP         HOUSEHOLD_EXPENDITURE</span></span>
<span><span class="co">##  Min.   :0.06481   Min.   :0.01845   Min.   :134773   Min.   :71647        </span></span>
<span><span class="co">##  1st Qu.:0.09159   1st Qu.:0.02596   1st Qu.:151629   1st Qu.:81181        </span></span>
<span><span class="co">##  Median :0.10665   Median :0.03619   Median :164700   Median :88666        </span></span>
<span><span class="co">##  Mean   :0.11257   Mean   :0.04362   Mean   :162472   Mean   :86882        </span></span>
<span><span class="co">##  3rd Qu.:0.13434   3rd Qu.:0.06109   3rd Qu.:173575   3rd Qu.:93219        </span></span>
<span><span class="co">##  Max.   :0.18964   Max.   :0.10123   Max.   :182620   Max.   :96548        </span></span>
<span><span class="co">##    GAS_PRICE     SCRAPPING_SUBSIDY</span></span>
<span><span class="co">##  Min.   :0.755   Min.   :0.0000   </span></span>
<span><span class="co">##  1st Qu.:1.019   1st Qu.:0.0000   </span></span>
<span><span class="co">##  Median :1.125   Median :0.0000   </span></span>
<span><span class="co">##  Mean   :1.140   Mean   :0.1645   </span></span>
<span><span class="co">##  3rd Qu.:1.317   3rd Qu.:0.0000   </span></span>
<span><span class="co">##  Max.   :1.445   Max.   :1.0000</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5.1</span>, <span class="fl">4.1</span>, <span class="fl">4.1</span>, <span class="fl">8.1</span><span class="op">)</span>, xpd<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">car_market</span><span class="op">$</span><span class="va">DATE</span>, y <span class="op">=</span> <span class="va">car_market</span><span class="op">$</span><span class="va">SEG_A</span>,type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"French vehicles market shares from 2003 to 2015"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"DATE"</span>, ylab <span class="op">=</span> <span class="st">"VALUE"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">car_market</span><span class="op">$</span><span class="va">DATE</span>, y <span class="op">=</span> <span class="va">car_market</span><span class="op">$</span><span class="va">SEG_B</span>,type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">car_market</span><span class="op">$</span><span class="va">DATE</span>, y <span class="op">=</span> <span class="va">car_market</span><span class="op">$</span><span class="va">SEG_C</span>,type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">car_market</span><span class="op">$</span><span class="va">DATE</span>, y <span class="op">=</span> <span class="va">car_market</span><span class="op">$</span><span class="va">SEG_D</span>,type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">car_market</span><span class="op">$</span><span class="va">DATE</span>, y <span class="op">=</span> <span class="va">car_market</span><span class="op">$</span><span class="va">SEG_E</span>,type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Segment "</span>, <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"orange"</span>, <span class="st">"black"</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fl">1</span>,</span>
<span>       inset<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.35</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Vignette_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">opar</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="regression-step">Regression step<a class="anchor" aria-label="anchor" href="#regression-step"></a>
</h3>
<p>We directly use the <code><a href="../reference/lmCoDa.html">lmCoDa()</a></code> function to fit a
regression model explaining the market shares as a function of household
expenditure, GDP, gas price and an indicator of the scrapping incentive
period. As previously, the compositional variable must be included as a
matrix.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">car_market</span><span class="op">$</span><span class="va">SEG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">car_market</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SEG_A"</span>,<span class="st">"SEG_B"</span>,<span class="st">"SEG_C"</span>,<span class="st">"SEG_D"</span>,<span class="st">"SEG_E"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Below we transform the response by an ilr, using the
<code><a href="https://rdrr.io/pkg/compositions/man/ilr.html" class="external-link">ilr()</a></code> function of the <strong>compositions</strong>
package.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_Y_compo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lmCoDa.html">lmCoDa</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/compositions/man/ilr.html" class="external-link">ilr</a></span><span class="op">(</span><span class="va">SEG</span><span class="op">)</span> <span class="op">~</span> <span class="va">HOUSEHOLD_EXPENDITURE</span> <span class="op">+</span> <span class="va">GDP</span> <span class="op">+</span> <span class="va">GAS_PRICE</span> <span class="op">+</span> <span class="va">SCRAPPING_SUBSIDY</span>,</span>
<span>  data<span class="op">=</span><span class="va">car_market</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="coef-1">coef<a class="anchor" aria-label="anchor" href="#coef-1"></a>
</h4>
<p>The estimated coefficients are retrieved using the
<code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code> function.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_Y_compo</span>, space <span class="op">=</span> <span class="st">"simplex"</span><span class="op">)</span>  <span class="co"># coefficients in the simplex</span></span></code></pre></div>
<pre><code><span><span class="co">##                            SEG_A      SEG_B     SEG_C     SEG_D     SEG_E</span></span>
<span><span class="co">## (Intercept)           0.00510613 0.02979117 0.0299574 0.1738140 0.7613313</span></span>
<span><span class="co">## HOUSEHOLD_EXPENDITURE 0.20004025 0.20000871 0.2000042 0.1999921 0.1999548</span></span>
<span><span class="co">## GDP                   0.19998123 0.19999792 0.2000000 0.2000025 0.2000184</span></span>
<span><span class="co">## GAS_PRICE             0.13249844 0.12769598 0.1583048 0.1951823 0.3863185</span></span>
<span><span class="co">## SCRAPPING_SUBSIDY     0.25071823 0.19046324 0.1729588 0.1825495 0.2033102</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_Y_compo</span><span class="op">)</span>                     <span class="co"># ... in ilr space</span></span></code></pre></div>
<pre><code><span><span class="co">##                            ilr(SEG)1      ilr(SEG)2      ilr(SEG)3</span></span>
<span><span class="co">## (Intercept)            1.24717388192  0.72459957006  2.03502320226</span></span>
<span><span class="co">## HOUSEHOLD_EXPENDITURE -0.00011150825 -0.00008293645 -0.00011093018</span></span>
<span><span class="co">## GDP                    0.00005900412  0.00004246356  0.00004089033</span></span>
<span><span class="co">## GAS_PRICE             -0.02610541082  0.16036864757  0.29475342664</span></span>
<span><span class="co">## SCRAPPING_SUBSIDY     -0.19436277707 -0.19093033990 -0.08827046806</span></span>
<span><span class="co">##                           ilr(SEG)4</span></span>
<span><span class="co">## (Intercept)            2.8974651795</span></span>
<span><span class="co">## HOUSEHOLD_EXPENDITURE -0.0002527637</span></span>
<span><span class="co">## GDP                    0.0001027078</span></span>
<span><span class="co">## GAS_PRICE              0.8389659267</span></span>
<span><span class="co">## SCRAPPING_SUBSIDY      0.0279658835</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="fitted-1">fitted<a class="anchor" aria-label="anchor" href="#fitted-1"></a>
</h4>
<p>For models with compositional response the <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code> also
has a space argument allowing to retrieve the fitted values in
coordinate space, clr space or in the simplex.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit_Y_compo</span>, space <span class="op">=</span> <span class="st">"simplex"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># coefficients in the simplex</span></span></code></pre></div>
<pre><code><span><span class="co">##   SEG_A        SEG_B       SEG_C       SEG_D       SEG_E       </span></span>
<span><span class="co">## 1 "0.06550853" "0.3518854" "0.3312294" "0.1636691" "0.08770752"</span></span>
<span><span class="co">## 2 "0.06506734" "0.3490900" "0.3309363" "0.1646582" "0.09024814"</span></span>
<span><span class="co">## 3 "0.06450031" "0.3455116" "0.3305134" "0.1659005" "0.09357414"</span></span>
<span><span class="co">## 4 "0.06266230" "0.3512741" "0.3315112" "0.1640017" "0.09055064"</span></span>
<span><span class="co">## 5 "0.06327936" "0.3553624" "0.3319284" "0.1625658" "0.08686404"</span></span>
<span><span class="co">## 6 "0.06335595" "0.3558713" "0.3319754" "0.1623847" "0.08641256"</span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "acomp"</span></span></code></pre>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit_Y_compo</span>, space <span class="op">=</span> <span class="st">"clr"</span><span class="op">)</span><span class="op">)</span>      <span class="co"># ... in clr space</span></span></code></pre></div>
<pre><code><span><span class="co">##        SEG_A     SEG_B     SEG_C      SEG_D      SEG_E</span></span>
<span><span class="co">## 1 -0.9018499 0.7792754 0.7187808 0.01381641 -0.6100227</span></span>
<span><span class="co">## 2 -0.9123999 0.7675070 0.7141032 0.01604937 -0.5852597</span></span>
<span><span class="co">## 3 -0.9258272 0.7525292 0.7081499 0.01889132 -0.5537431</span></span>
<span><span class="co">## 4 -0.9439949 0.7798119 0.7219066 0.01812205 -0.5758457</span></span>
<span><span class="co">## 5 -0.9286494 0.7969295 0.7287105 0.01487411 -0.6118646</span></span>
<span><span class="co">## 6 -0.9267313 0.7990692 0.7295609 0.01446811 -0.6163670</span></span></code></pre>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">fit_Y_compo</span><span class="op">)</span><span class="op">)</span>                     <span class="co"># ... in ilr space (as in the estimation)</span></span></code></pre></div>
<pre><code><span><span class="co">##       [,1]      [,2]       [,3]       [,4]</span></span>
<span><span class="co">## 1 1.188735 0.6369230 -0.1601446 -0.6820261</span></span>
<span><span class="co">## 2 1.187874 0.6422151 -0.1504177 -0.6543402</span></span>
<span><span class="co">## 3 1.186777 0.6489506 -0.1380381 -0.6191037</span></span>
<span><span class="co">## 4 1.218916 0.6564617 -0.1453068 -0.6438151</span></span>
<span><span class="co">## 5 1.220169 0.6487640 -0.1594550 -0.6840855</span></span>
<span><span class="co">## 6 1.220325 0.6478018 -0.1612235 -0.6891192</span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "rmult"</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="resid">resid<a class="anchor" aria-label="anchor" href="#resid"></a>
</h4>
<p>The same functionality is available for the residuals.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">fit_Y_compo</span>, space <span class="op">=</span> <span class="st">"simplex"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># coefficients in the simplex</span></span></code></pre></div>
<pre><code><span><span class="co">##   SEG_A       SEG_B       SEG_C       SEG_D       SEG_E      </span></span>
<span><span class="co">## 1 "0.2100350" "0.2099886" "0.1900386" "0.1819359" "0.2080019"</span></span>
<span><span class="co">## 2 "0.2241523" "0.1884051" "0.2165972" "0.1887411" "0.1821043"</span></span>
<span><span class="co">## 3 "0.1990092" "0.1761677" "0.2160209" "0.2230781" "0.1857242"</span></span>
<span><span class="co">## 4 "0.2015812" "0.2391805" "0.2238778" "0.2106168" "0.1247437"</span></span>
<span><span class="co">## 5 "0.2229353" "0.2138702" "0.2243390" "0.1821381" "0.1567175"</span></span>
<span><span class="co">## 6 "0.1971703" "0.2164442" "0.2369534" "0.1682997" "0.1811324"</span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "acomp"</span></span></code></pre>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">fit_Y_compo</span>, space <span class="op">=</span> <span class="st">"clr"</span><span class="op">)</span><span class="op">)</span>      <span class="co"># ... in clr space</span></span></code></pre></div>
<pre><code><span><span class="co">##          SEG_A       SEG_B       SEG_C       SEG_D       SEG_E</span></span>
<span><span class="co">## 1  0.050722716  0.05050182 -0.04932391 -0.09289665  0.04099603</span></span>
<span><span class="co">## 2  0.117542428 -0.05618878  0.08325649 -0.05440689 -0.09020325</span></span>
<span><span class="co">## 3 -0.001038231 -0.12295300  0.08098568  0.11313241 -0.07012686</span></span>
<span><span class="co">## 4  0.032029651  0.20305589  0.13693794  0.07587790 -0.44790138</span></span>
<span><span class="co">## 5  0.117957913  0.07644556  0.12423438 -0.08415879 -0.23447906</span></span>
<span><span class="co">## 6 -0.006779935  0.08648514  0.17701586 -0.16510139 -0.09161968</span></span></code></pre>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">resid</a></span><span class="op">(</span><span class="va">fit_Y_compo</span><span class="op">)</span><span class="op">)</span>                     <span class="co"># ... in ilr space (as in the estimation)</span></span></code></pre></div>
<pre><code><span><span class="co">##            [,1]        [,2]        [,3]        [,4]</span></span>
<span><span class="co">## 1 -0.0001561993 -0.08159755 -0.09543328  0.04583496</span></span>
<span><span class="co">## 2 -0.1228465125  0.04293111 -0.08886310 -0.10085030</span></span>
<span><span class="co">## 3 -0.0862067605  0.11674374  0.11039017 -0.07840421</span></span>
<span><span class="co">## 4  0.1209338141  0.01583609 -0.04168174 -0.50076897</span></span>
<span><span class="co">## 5 -0.0293536636  0.02207206 -0.16486648 -0.26215556</span></span>
<span><span class="co">## 6  0.0659483699  0.11199333 -0.21709099 -0.10243392</span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "rmult"</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="interpretation-tools-1">Interpretation tools<a class="anchor" aria-label="anchor" href="#interpretation-tools-1"></a>
</h3>
<div class="section level4">
<h4 id="finite-increments-interpretation-1">Finite increments interpretation<a class="anchor" aria-label="anchor" href="#finite-increments-interpretation-1"></a>
</h4>
<div class="section level5">
<h5 id="interpretation-with-ilr-coordinates-1">Interpretation with ilr coordinates<a class="anchor" aria-label="anchor" href="#interpretation-with-ilr-coordinates-1"></a>
</h5>
<p>Finite increments interpretation as in Muller et al. (2018) can be
obtained using coordinate space outputs.</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_Y_compo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                            ilr(SEG)1      ilr(SEG)2      ilr(SEG)3</span></span>
<span><span class="co">## (Intercept)            1.24717388192  0.72459957006  2.03502320226</span></span>
<span><span class="co">## HOUSEHOLD_EXPENDITURE -0.00011150825 -0.00008293645 -0.00011093018</span></span>
<span><span class="co">## GDP                    0.00005900412  0.00004246356  0.00004089033</span></span>
<span><span class="co">## GAS_PRICE             -0.02610541082  0.16036864757  0.29475342664</span></span>
<span><span class="co">## SCRAPPING_SUBSIDY     -0.19436277707 -0.19093033990 -0.08827046806</span></span>
<span><span class="co">##                           ilr(SEG)4</span></span>
<span><span class="co">## (Intercept)            2.8974651795</span></span>
<span><span class="co">## HOUSEHOLD_EXPENDITURE -0.0002527637</span></span>
<span><span class="co">## GDP                    0.0001027078</span></span>
<span><span class="co">## GAS_PRICE              0.8389659267</span></span>
<span><span class="co">## SCRAPPING_SUBSIDY      0.0279658835</span></span></code></pre>
<p>Following Muller et al. (2018), using the default contrast matrix
below, we can interpret the impact of an additive change in the
household expenditure variable on the ratio between segment E and the
geometric mean of the other segments.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/compositions/man/ilrBase.html" class="external-link">ilrBase</a></span><span class="op">(</span>D <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="co"># default contrast matrix</span></span></code></pre></div>
<pre><code><span><span class="co">##         [,1]       [,2]       [,3]       [,4]</span></span>
<span><span class="co">## 1 -0.7071068 -0.4082483 -0.2886751 -0.2236068</span></span>
<span><span class="co">## 2  0.7071068 -0.4082483 -0.2886751 -0.2236068</span></span>
<span><span class="co">## 3  0.0000000  0.8164966 -0.2886751 -0.2236068</span></span>
<span><span class="co">## 4  0.0000000  0.0000000  0.8660254 -0.2236068</span></span>
<span><span class="co">## 5  0.0000000  0.0000000  0.0000000  0.8944272</span></span></code></pre>
<p>If the household expenditure, expressed in chain-linked prices of the
previous year, increases by <span class="math inline">\(250\)</span>
million euros, approximately one percent of its range, the ratio between
segment E and the geometric mean of the other segments is multiplied by
<span class="math inline">\(\exp((-0.0025) * 250/0.89)\sim
0.49,\)</span> hence approximately divided by two. However, it is
difficult to describe the simultaneous changes in the ratio between the
other segments with this approach.</p>
</div>
<div class="section level5">
<h5 id="variation-scenario-in-real-space">Variation scenario in real space<a class="anchor" aria-label="anchor" href="#variation-scenario-in-real-space"></a>
</h5>
<p>In this part, we are interested in presenting on a graph the
variations of the fitted shares corresponding to a change scenario of
the variable “HOUSEHOLD_EXPENDITURE”. In this case, since the variable
to be changed is scalar, the scenario of change is just a regular grid
of values defined by a step size, a number of steps and an initial
observation. The first step <code><a href="../reference/VariationScenario.html">VariationScenario()</a></code> creates the
grid for the covariate (<span class="math inline">\(X\)</span>) and
computes the corresponding fitted values (<span class="math inline">\(Y\)</span>).</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vs_exp2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VariationScenario.html">VariationScenario</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_Y_compo</span>,</span>
<span>  Xvar <span class="op">=</span> <span class="st">"HOUSEHOLD_EXPENDITURE"</span>,</span>
<span>  obs <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  inc_size <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  n_steps <span class="op">=</span> <span class="fl">150</span>,</span>
<span>  add_opposite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vs_exp2</span><span class="op">$</span><span class="va">HOUSEHOLD_EXPENDITURE</span>, y <span class="op">=</span> <span class="va">vs_exp2</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>     main <span class="op">=</span> <span class="st">"Variation scenario of houshold expenditure for observation 1"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Household expenditure"</span>, ylab <span class="op">=</span> <span class="st">"Market share of segment"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vs_exp2</span><span class="op">$</span><span class="va">HOUSEHOLD_EXPENDITURE</span>, y <span class="op">=</span> <span class="va">vs_exp2</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>,type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"blue"</span> <span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vs_exp2</span><span class="op">$</span><span class="va">HOUSEHOLD_EXPENDITURE</span>, y <span class="op">=</span> <span class="va">vs_exp2</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>,type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"green"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vs_exp2</span><span class="op">$</span><span class="va">HOUSEHOLD_EXPENDITURE</span>, y <span class="op">=</span> <span class="va">vs_exp2</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>,<span class="fl">4</span><span class="op">]</span>,type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">vs_exp2</span><span class="op">$</span><span class="va">HOUSEHOLD_EXPENDITURE</span>, y <span class="op">=</span> <span class="va">vs_exp2</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span>,type <span class="op">=</span> <span class="st">"l"</span>, col <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"SEG_"</span>, <span class="va">LETTERS</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>, <span class="st">"orange"</span>, <span class="st">"black"</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Vignette_files/figure-html/unnamed-chunk-30-1.png" width="700"></p>
</div>
</div>
<div class="section level4">
<h4 id="infinitesimal-increments-interpretation-1">Infinitesimal increments interpretation<a class="anchor" aria-label="anchor" href="#infinitesimal-increments-interpretation-1"></a>
</h4>
<div class="section level5">
<h5 id="semi-elasticities-1">Semi-elasticities<a class="anchor" aria-label="anchor" href="#semi-elasticities-1"></a>
</h5>
<p>The use of semi-elasticities for the interpretation of compositional
covariates is described in Morais and Thomas-Agnan (2021). The only
difference with the previous section is that it involves derivatives of
the logarithm of the <span class="math inline">\(Y\)</span> components
with respect to <span class="math inline">\(X\)</span>, in contrast with
derivatives of <span class="math inline">\(Y\)</span> with respect to
the logarithm of the components of <span class="math inline">\(X\)</span>. The <code><a href="../reference/Impacts.html">Impacts()</a></code> function
computes these elasticities.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Impacts.html">Impacts</a></span><span class="op">(</span><span class="va">fit_Y_compo</span>,</span>
<span>        Xvar <span class="op">=</span> <span class="st">"HOUSEHOLD_EXPENDITURE"</span>,</span>
<span>        obs<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                              SEG_A         SEG_B         SEG_C          SEG_D</span></span>
<span><span class="co">## HOUSEHOLD_EXPENDITURE 0.0001933935 0.00003569699 0.00001296924 -0.00004740457</span></span>
<span><span class="co">##                               SEG_E</span></span>
<span><span class="co">## HOUSEHOLD_EXPENDITURE -0.0002339346</span></span>
<span><span class="co">## attr(,"obs")</span></span>
<span><span class="co">## [1] 4</span></span></code></pre>
<p>The semi-elasticities are then used for evaluating the impact on
<span class="math inline">\(Y\)</span> of an infinitesimal additive
change of any of the scalar explanatory variables.</p>
</div>
<div class="section level5">
<h5 id="infinitesimal-increments-approach">Infinitesimal Increments approach<a class="anchor" aria-label="anchor" href="#infinitesimal-increments-approach"></a>
</h5>
<p>For example, we can measure the change caused by an increase of <span class="math inline">\(2500\)</span> million euros in
<code>HOUSEHOLD_EXPENDITURE</code> using the function
<code><a href="../reference/VariationTable.html">VariationTable()</a></code>.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_Y_compo.VarTab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VariationTable.html">VariationTable</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_Y_compo</span>,                      <span class="co"># model output</span></span>
<span>  Xvar <span class="op">=</span> <span class="st">"HOUSEHOLD_EXPENDITURE"</span>,   <span class="co"># variable to be changed</span></span>
<span>  inc_size <span class="op">=</span> <span class="fl">2500</span>,                  <span class="co"># additive increment of X</span></span>
<span>  obs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>                          <span class="co"># observation index</span></span>
<span></span>
<span><span class="va">fit_Y_compo.VarTab</span></span></code></pre></div>
<pre><code><span><span class="co">##                              SEG_A         SEG_B         SEG_C           SEG_D</span></span>
<span><span class="co">## Initial parts          0.065508533 0.35188544895 0.33122939357   0.16366910523</span></span>
<span><span class="co">## New parts              0.096976210 0.38218939438 0.34093421621   0.14376119345</span></span>
<span><span class="co">## Semi elasticity        0.000192144 0.00003444751 0.00001171976  -0.00004865405</span></span>
<span><span class="co">## Variation in %        48.035998361 8.61187796119 2.92994004579 -12.16351231860</span></span>
<span><span class="co">## Variation in % points  3.146767770 3.03039454268 0.97048226455  -1.99079117759</span></span>
<span><span class="co">##                                SEG_E</span></span>
<span><span class="co">## Initial parts           0.0877075195</span></span>
<span><span class="co">## New parts               0.0361389855</span></span>
<span><span class="co">## Semi elasticity        -0.0002351841</span></span>
<span><span class="co">## Variation in %        -58.7960237233</span></span>
<span><span class="co">## Variation in % points  -5.1568533997</span></span></code></pre>
<p>For the first month, an increase of <span class="math inline">\(2500\)</span> million euros of total
<code>HOUSEHOLD_EXPENDITURE</code> will result in a decrease of 2
percentage points in the “SEG_D” share, and an increase of 3 percentage
points in the “SEG_B” share. We can visualize these changes more
globally with a barplot.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html" class="external-link">barplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">fit_Y_compo.VarTab</span><span class="op">[</span><span class="fl">5</span>,<span class="op">]</span><span class="op">)</span>,col <span class="op">=</span> <span class="st">"cyan"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Market segment shares variations"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Vignette_files/figure-html/unnamed-chunk-33-1.png" width="700"></p>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="composition-on-composition-regression">Composition on composition regression<a class="anchor" aria-label="anchor" href="#composition-on-composition-regression"></a>
</h2>
<p>This case is illustrated using an example from Nguyen et. al (2020)
studying the impact of some socio-economic variables on the outcome of
French departmental elections in 2015.</p>
<div class="section level3">
<h3 id="election-data">Election data<a class="anchor" aria-label="anchor" href="#election-data"></a>
</h3>
<p>This dataset contains the vote shares for 3 groups of parties
(<code>left</code>, <code>right</code>, <code>extreme_right</code>) in
different departments of France in the 2015 French departmental election
for 95 departments in France. The election results originate from the
French ‘Ministry of the Interior’. The corresponding socio-economic data
(for 2014) have been downloaded from the <a href="https://www.insee.fr/" class="external-link">INSEE website</a>. The regression involves
the following explanatory variables:</p>
<ul>
<li>four scalar variables: the unemployment rate
(<code>unemp_rate</code>), the proportion of people who own assets
(<code>asset_owner_rate</code>), the proportion of people who pay income
tax (<code>income_taxpayer_rate</code>), the proportion of foreigners
(<code>forgeigner_rate</code>).</li>
<li>two compositional variables:
<ul>
<li>the Age variable has three levels: <code>Age_1839</code> for people
from 18 to 39 years old, <code>Age_4064</code> for people from 40 to 64
years old, and <code>Age_65plus</code> for people over 65.</li>
<li>Diploma has three levels: <code>Educ_BeforeHighschool</code> for
people with at most some secondary education,
<code>Educ_Highschool</code> for people with at least secondary
education and at most a high school diploma, and
<code>Educ_Higher</code> for people with a university diploma.</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"election"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">election</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##       left            right        extreme_right    </span></span>
<span><span class="co">##  Min.   :0.1740   Min.   :0.1195   Min.   :0.05563  </span></span>
<span><span class="co">##  1st Qu.:0.3108   1st Qu.:0.3296   1st Qu.:0.19956  </span></span>
<span><span class="co">##  Median :0.3598   Median :0.3760   Median :0.26102  </span></span>
<span><span class="co">##  Mean   :0.3682   Mean   :0.3841   Mean   :0.24777  </span></span>
<span><span class="co">##  3rd Qu.:0.4322   3rd Qu.:0.4421   3rd Qu.:0.30400  </span></span>
<span><span class="co">##  Max.   :0.7228   Max.   :0.6367   Max.   :0.41485</span></span></code></pre>
<div class="sourceCode" id="cb91"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">election</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     Age_1839         Age_4064        Age_65plus    </span></span>
<span><span class="co">##  Min.   :0.2270   Min.   :0.3836   Min.   :0.1536  </span></span>
<span><span class="co">##  1st Qu.:0.2756   1st Qu.:0.4208   1st Qu.:0.2243  </span></span>
<span><span class="co">##  Median :0.3077   Median :0.4315   Median :0.2613  </span></span>
<span><span class="co">##  Mean   :0.3140   Mean   :0.4295   Mean   :0.2566  </span></span>
<span><span class="co">##  3rd Qu.:0.3486   3rd Qu.:0.4384   3rd Qu.:0.2872  </span></span>
<span><span class="co">##  Max.   :0.4320   Max.   :0.4511   Max.   :0.3364</span></span></code></pre>
<div class="sourceCode" id="cb93"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">election</span><span class="op">[</span><span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  Educ_BeforeHighschool Educ_Highschool   Educ_Higher    </span></span>
<span><span class="co">##  Min.   :0.3484        Min.   :0.1444   Min.   :0.1617  </span></span>
<span><span class="co">##  1st Qu.:0.5613        1st Qu.:0.1596   1st Qu.:0.2034  </span></span>
<span><span class="co">##  Median :0.5918        Median :0.1677   Median :0.2324  </span></span>
<span><span class="co">##  Mean   :0.5889        Mean   :0.1689   Mean   :0.2422  </span></span>
<span><span class="co">##  3rd Qu.:0.6349        3rd Qu.:0.1780   3rd Qu.:0.2670  </span></span>
<span><span class="co">##  Max.   :0.6867        Max.   :0.2234   Max.   :0.4998</span></span></code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">election</span><span class="op">[</span><span class="fl">10</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    unemp_rate      asset_owner_rate income_taxpayer_rate forgeigner_rate  </span></span>
<span><span class="co">##  Min.   :0.08353   Min.   :0.3998   Min.   :0.4499       Min.   :0.01342  </span></span>
<span><span class="co">##  1st Qu.:0.10513   1st Qu.:0.5894   1st Qu.:0.5143       1st Qu.:0.02994  </span></span>
<span><span class="co">##  Median :0.11648   Median :0.6189   Median :0.5432       Median :0.04436  </span></span>
<span><span class="co">##  Mean   :0.11731   Mean   :0.6158   Mean   :0.5525       Mean   :0.05049  </span></span>
<span><span class="co">##  3rd Qu.:0.12423   3rd Qu.:0.6645   3rd Qu.:0.5777       3rd Qu.:0.05886  </span></span>
<span><span class="co">##  Max.   :0.16246   Max.   :0.7229   Max.   :0.7452       Max.   :0.22824</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="regression-step-1">Regression step<a class="anchor" aria-label="anchor" href="#regression-step-1"></a>
</h3>
<p>First, we must ensure that all compositional variables are stored as
a matrix.</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">election</span><span class="op">$</span><span class="va">VOTE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">election</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>,<span class="st">"right"</span>,<span class="st">"extreme_right"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">election</span><span class="op">$</span><span class="va">AGE</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">election</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Age_1839"</span>,<span class="st">"Age_4064"</span>,<span class="st">"Age_65plus"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">election</span><span class="op">$</span><span class="va">EDUC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">election</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Educ_BeforeHighschool"</span>,<span class="st">"Educ_Highschool"</span>,<span class="st">"Educ_Higher"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The next step consists of applying a log-ratio transformation (alr or
ilr) to the compositional variables and then using the “lm” function to
perform regression in coordinates space. In this example, the response
variable, <code>VOTE</code>, is transformed by an ilr, the variable
<code>Age</code> is transformed by an alr, and <code>EDUC</code> is
transformed by an ilr.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_YX_compo</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lmCoDa.html">lmCoDa</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/compositions/man/ilr.html" class="external-link">ilr</a></span><span class="op">(</span><span class="va">VOTE</span><span class="op">)</span> <span class="op">~</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/compositions/man/alr.html" class="external-link">alr</a></span><span class="op">(</span><span class="va">AGE</span><span class="op">)</span> <span class="op">+</span> <span class="va">unemp_rate</span> <span class="op">+</span> <span class="va">asset_owner_rate</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/compositions/man/ilr.html" class="external-link">ilr</a></span><span class="op">(</span><span class="va">EDUC</span><span class="op">)</span> <span class="op">+</span> <span class="va">income_taxpayer_rate</span> <span class="op">+</span> <span class="va">forgeigner_rate</span>,</span>
<span>  data <span class="op">=</span> <span class="va">election</span><span class="op">)</span></span></code></pre></div>
<p>With the <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code> function we can access the estimated
coefficients in coordinate space, as well as in the simplex:</p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_YX_compo</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                       ilr(VOTE)1 ilr(VOTE)2</span></span>
<span><span class="co">## (Intercept)          -0.07020983 -6.9109264</span></span>
<span><span class="co">## alr(AGE)Age_1839     -0.10463431  0.5592385</span></span>
<span><span class="co">## alr(AGE)Age_4064      0.23336593 -0.2278400</span></span>
<span><span class="co">## unemp_rate           -8.16701488 17.2562747</span></span>
<span><span class="co">## asset_owner_rate     -2.96545832  2.8971115</span></span>
<span><span class="co">## ilr(EDUC)1           -1.21486657 -2.2816886</span></span>
<span><span class="co">## ilr(EDUC)2           -0.76776003  0.9077666</span></span>
<span><span class="co">## income_taxpayer_rate  2.91875389  1.7559045</span></span>
<span><span class="co">## forgeigner_rate      -1.45607088 -0.5496067</span></span></code></pre>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_YX_compo</span>, space <span class="op">=</span> <span class="st">"simplex"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                                   left                right extreme_right</span></span>
<span><span class="co">## (Intercept)            0.5247472819482  0.47514740845404074  0.0001053096</span></span>
<span><span class="co">## Age_1839              -0.1543205229982 -0.30229578360147996  0.4566163066</span></span>
<span><span class="co">## Age_4064              -0.0719993474717  0.25802991714545126 -0.1860305697</span></span>
<span><span class="co">## Age_65plus             0.2263198704699  0.04426586645602869 -0.2705857369</span></span>
<span><span class="co">## unemp_rate             0.0000002135099  0.00000000000205759  0.9999997865</span></span>
<span><span class="co">## asset_owner_rate       0.1892554610820  0.00285566966007836  0.8078888693</span></span>
<span><span class="co">## Educ_BeforeHighschool -1.3364388553996  0.32169418104455588  1.0147446744</span></span>
<span><span class="co">## Educ_Highschool        1.1957612695548  0.42416115809884591 -1.6199224277</span></span>
<span><span class="co">## Educ_Higher            0.1406775858448 -0.74585533914340196  0.6051777533</span></span>
<span><span class="co">## income_taxpayer_rate   0.0076516015515  0.47468732197433899  0.5176610765</span></span>
<span><span class="co">## forgeigner_rate        0.7635086355050  0.09739055674009536  0.1391008078</span></span></code></pre>
<p>Standard errors and confidence intervals are provided for the clr of
parameters by the function <code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code>. The following example
is for the case of the compositional explanatory variable
<code>AGE</code>.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fit_YX_compo</span>, parm <span class="op">=</span> <span class="st">"AGE"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               Y          X         EST        SD      2.5 %     97.5 %</span></span>
<span><span class="co">## 1          left   Age_1839 -0.15432052 0.4909885 -1.1303733 0.82173229</span></span>
<span><span class="co">## 2         right   Age_1839 -0.30229578 0.3747233 -1.0472210 0.44262946</span></span>
<span><span class="co">## 3 extreme_right   Age_1839  0.45661631 0.3953292 -0.3292722 1.24250484</span></span>
<span><span class="co">## 4          left   Age_4064 -0.07199935 0.6721951 -1.4082790 1.26428030</span></span>
<span><span class="co">## 5         right   Age_4064  0.25802992 0.5130205 -0.7618211 1.27788092</span></span>
<span><span class="co">## 6 extreme_right   Age_4064 -0.18603057 0.5412314 -1.2619630 0.88990183</span></span>
<span><span class="co">## 7          left Age_65plus  0.22631987 0.1919484 -0.1552609 0.60790069</span></span>
<span><span class="co">## 8         right Age_65plus  0.04426587 0.1464954 -0.2469573 0.33548902</span></span>
<span><span class="co">## 9 extreme_right Age_65plus -0.27058574 0.1545511 -0.5778232 0.03665172</span></span></code></pre>
<p>When providing the argument <code>y_ref</code> the function returns
the same information for the differences of clr parameter values, which
coincide with differences in elasticities (Dargel and Thomas-Agnan
2023).</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fit_YX_compo</span>, parm <span class="op">=</span> <span class="st">"AGE"</span>, y_ref <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Y_ref             Y          X       DIFF        SD      2.5 %    97.5 %</span></span>
<span><span class="co">## 1  left          left   Age_1839  0.0000000 0.0000000  0.0000000 0.0000000</span></span>
<span><span class="co">## 2  left         right   Age_1839 -0.1479753 0.7789026 -1.6963824 1.4004319</span></span>
<span><span class="co">## 3  left extreme_right   Age_1839  0.6109368 0.8088834 -0.9970701 2.2189437</span></span>
<span><span class="co">## 4  left          left   Age_4064  0.0000000 0.0000000  0.0000000 0.0000000</span></span>
<span><span class="co">## 5  left         right   Age_4064  0.3300293 1.0663682 -1.7898406 2.4498991</span></span>
<span><span class="co">## 6  left extreme_right   Age_4064 -0.1140312 1.1074138 -2.3154970 2.0874346</span></span>
<span><span class="co">## 7  left          left Age_65plus  0.0000000 0.0000000  0.0000000 0.0000000</span></span>
<span><span class="co">## 8  left         right Age_65plus -0.1820540 0.3045064 -0.7873926 0.4232846</span></span>
<span><span class="co">## 9  left extreme_right Age_65plus -0.4969056 0.3162271 -1.1255443 0.1317331</span></span></code></pre>
<p>The following example is for the case of the scalar explanatory
variable <code>unemp_rate</code>.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fit_YX_compo</span>, parm <span class="op">=</span> <span class="st">"unemp_rate"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               Y          X        EST       SD      2.5 %    97.5 %</span></span>
<span><span class="co">## 1          left unemp_rate  -1.269893 2.465914  -6.171968  3.632182</span></span>
<span><span class="co">## 2         right unemp_rate -12.819796 1.881990 -16.561068 -9.078524</span></span>
<span><span class="co">## 3 extreme_right unemp_rate  14.089689 1.985480  10.142685 18.036693</span></span></code></pre>
<p>In this case the difference in clr parameters coincides with a
semi-elasticities difference.</p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">fit_YX_compo</span>, parm <span class="op">=</span> <span class="st">"unemp_rate"</span>, y_ref <span class="op">=</span> <span class="st">"left"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   Y_ref             Y          X      DIFF       SD      2.5 %    97.5 %</span></span>
<span><span class="co">## 1  left          left unemp_rate   0.00000 0.000000   0.000000  0.000000</span></span>
<span><span class="co">## 2  left         right unemp_rate -11.54990 3.911918 -19.326539 -3.773267</span></span>
<span><span class="co">## 3  left extreme_right unemp_rate  15.35958 4.062492   7.283616 23.435549</span></span></code></pre>
<p>Fitted values and residuals, both in the simplex space, can be
accessed directly using fitted, and residuals functions as shown
previously.</p>
</div>
<div class="section level3">
<h3 id="interpretation-tools-2">Interpretation tools<a class="anchor" aria-label="anchor" href="#interpretation-tools-2"></a>
</h3>
<div class="section level4">
<h4 id="finite-increments">Finite increments<a class="anchor" aria-label="anchor" href="#finite-increments"></a>
</h4>
<div class="section level5">
<h5 id="interpretation-with-ilr-coordinates-2">Interpretation with ilr coordinates<a class="anchor" aria-label="anchor" href="#interpretation-with-ilr-coordinates-2"></a>
</h5>
<p>Finite increments interpretation as in Muller et al. (2018) can be
obtained using coordinate space outputs, but this time we need to
consider two contrast matrices, one for the response and one for the
explanatory composition. In the present model, the <code>VOTE</code> and
the <code>EDUC</code> compositions are both ilr transformed with the
default contrast matrix.</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/compositions/man/ilrBase.html" class="external-link">ilrBase</a></span><span class="op">(</span>D <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         [,1]       [,2]</span></span>
<span><span class="co">## 1 -0.7071068 -0.4082483</span></span>
<span><span class="co">## 2  0.7071068 -0.4082483</span></span>
<span><span class="co">## 3  0.0000000  0.8164966</span></span></code></pre>
<p>This means we can interpret the element in the last row and last
column of the corresponding parameter matrix that is expressed using the
ilr spaces of both the response <code>VOTE</code> and the “EDUC”
variables (whose contrast matrices coincide in our example).</p>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_YX_compo</span>, split <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="st">"ilr(EDUC)"</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##            ilr(VOTE)1 ilr(VOTE)2</span></span>
<span><span class="co">## ilr(EDUC)1  -1.214867 -2.2816886</span></span>
<span><span class="co">## ilr(EDUC)2  -0.767760  0.9077666</span></span></code></pre>
<p>The value of about <span class="math inline">\(0.90777\)</span>
indicates that an additive unit increase in the second ilr coordinate of
the explanatory <code>EDUC</code> composition leads to an additive
increase of the second ilr coordinate of the response <code>VOTE</code>
composition. Given the form of the contrast matrix, these ilr
coordinates can be interpreted as principal balances of the last
component against the first two in both compositions. The above change
in education corresponds to a move in the direction of the high
education vertex in the simplex. Therefore, a multiplication of the
ratio between the higher education level to the geometric mean of the
other two by <span class="math inline">\(\exp(1/081) \sim 3.43\)</span>
induces a multiplication of the ratio of the vote share for the extreme
right party to the geometric mean of the other two parties by <span class="math inline">\(\exp(0.91/081)\sim 3.07.\)</span> If one wishes to
evaluate the impact of this change on other ratios of <span class="math inline">\(Y\)</span> it would mean changing the contrast
matrix of the response. Similarly, if one wishes to evaluate the impact
of changing the education composition in the direction of the other two
vertices, it would mean changing the <span class="math inline">\(X\)</span> contrast matrix.</p>
</div>
<div class="section level5">
<h5 id="variationscenario">VariationScenario<a class="anchor" aria-label="anchor" href="#variationscenario"></a>
</h5>
<p>As in the case of scalar on composition regression, to evaluate the
impact of a given compositional covariate, we create scenarios of
changes in its simplex space described by a linear equation <span class="math inline">\(x(h)=x(0)\oplus h\odot u,\)</span> where <span class="math inline">\(x(0)\)</span> is the initial point, <span class="math inline">\(h\)</span> is the signed-intensity of change and
<span class="math inline">\(u\)</span> is a vector of the simplex
defining the direction of change. We then compute the predicted value
<span class="math inline">\(y(h)\)</span> corresponding to <span class="math inline">\(x(h)\)</span>, keeping the other covariates at
their value for the initial point.</p>
<p>To present the variations of <span class="math inline">\(Y\)</span>
induced by a change scenario of <span class="math inline">\(X\)</span>,
we propose two plots. The first one is a graph of the shares of <span class="math inline">\(Y\)</span> as a function of one of the shares of
<span class="math inline">\(X\)</span> and the second one presents the
evolution of the other shares of <span class="math inline">\(X\)</span>.
In the following illustration, we choose the direction of change joining
the initial point (in this case, observation 1, Landes department) to
the vertex <code>Age_1839</code>.</p>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VS_election</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/VariationScenario.html">VariationScenario</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_YX_compo</span>,</span>
<span>  Xvar <span class="op">=</span> <span class="st">"AGE"</span>,</span>
<span>  Xdir <span class="op">=</span> <span class="st">"Age_1839"</span>,</span>
<span>  n_steps <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  obs <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">opar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,  y <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"Orange"</span>,</span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"% Age_1839"</span>, ylab <span class="op">=</span> <span class="st">"% VOTE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,  y <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,  y <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="st">"darkblue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,  y <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">Y</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"top"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"right"</span>, <span class="st">"extreme_right"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"orange"</span>, <span class="st">"darkblue"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,  y <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"Orange"</span>,</span>
<span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, xlab <span class="op">=</span> <span class="st">"% Age_1839"</span>, ylab <span class="op">=</span> <span class="st">"% AGE"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,  y <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,  y <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="st">"darkblue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>,  y <span class="op">=</span> <span class="va">VS_election</span><span class="op">$</span><span class="va">X</span><span class="op">[</span>,<span class="fl">3</span><span class="op">]</span>, lwd <span class="op">=</span> <span class="fl">1.5</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"top"</span>,</span>
<span>       legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"18-39"</span>,<span class="st">"40-64"</span>, <span class="st">"65_plus"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"orange"</span>, <span class="st">"darkblue"</span>, <span class="st">"red"</span><span class="op">)</span>,</span>
<span>       lty <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="Vignette_files/figure-html/unnamed-chunk-44-1.png" width="960"></p>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">opar</span><span class="op">)</span></span></code></pre></div>
<p>The vertical line corresponds to the initial department of Landes,
and we can read the values of its fitted vote shares on the first graph
and the values of its age characteristics on the second.<br>
For the specified direction, the bottom graph shows that an increase in
the share of voters aged between <span class="math inline">\(18\)</span>
and <span class="math inline">\(39\)</span> years corresponds to a
linear decrease in the other shares. On the top graph, we see that an
increase in the share of voters aged between <span class="math inline">\(18\)</span> and <span class="math inline">\(39\)</span> years induces an increase in the share
of the extreme right, a decrease in the share of the right parties, and
a simultaneous decrease in the left party’s share.</p>
</div>
</div>
<div class="section level4">
<h4 id="infinitesimal-increments">Infinitesimal increments<a class="anchor" aria-label="anchor" href="#infinitesimal-increments"></a>
</h4>
<div class="section level5">
<h5 id="elasticities">Elasticities<a class="anchor" aria-label="anchor" href="#elasticities"></a>
</h5>
<p>The function <code><a href="../reference/Impacts.html">Impacts()</a></code> computes elasticities (or
semi-elasticities, depending on the nature of the considered covariate)
of covariates for a given observation. This function takes a “lmCoDa”
object as input, along with the covariate’s name and the index of the
observation.</p>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Impacts.html">Impacts</a></span><span class="op">(</span><span class="va">fit_YX_compo</span>, Xvar <span class="op">=</span> <span class="st">'AGE'</span>, obs <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                  left      right extreme_right</span></span>
<span><span class="co">## Age_1839   -0.1279812 -0.2759565     0.4829556</span></span>
<span><span class="co">## Age_4064   -0.1051949  0.2248344    -0.2192261</span></span>
<span><span class="co">## Age_65plus  0.2331761  0.0511221    -0.2637295</span></span>
<span><span class="co">## attr(,"obs")</span></span>
<span><span class="co">## [1] 3</span></span></code></pre>
<p>The semi-elasticities are then used for evaluating the impact on
<span class="math inline">\(Y\)</span> of an infinitesimal additive
change of any of the scalar explanatory variables.</p>
</div>
<div class="section level5">
<h5 id="increments-approach-1">Increments approach<a class="anchor" aria-label="anchor" href="#increments-approach-1"></a>
</h5>
<div class="section level6">
<h6 id="infinitesimal-increment-direction-pointing-to-a-vertex-1">Infinitesimal increment: direction pointing to a vertex<a class="anchor" aria-label="anchor" href="#infinitesimal-increment-direction-pointing-to-a-vertex-1"></a>
</h6>
<p>For example, we can measure the change caused by increasing the
<code>Higher</code> share of the <code>EDUC</code> variable by 5%,
assuming that the ratio between the other two components remains
constant, using the function <code><a href="../reference/VariationTable.html">VariationTable()</a></code>. Assuming
that the voting population for the first department is <span class="math inline">\(100\;000\)</span> individuals (we do not have this
information in the dataset). The total of the response must be specified
by the user in case he wants to know the variation in units.</p>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/VariationTable.html">VariationTable</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_YX_compo</span>,</span>
<span>  Xvar <span class="op">=</span> <span class="st">"AGE"</span>,</span>
<span>  Xdir <span class="op">=</span> <span class="st">'Age_1839'</span>,</span>
<span>  Ytotal <span class="op">=</span> <span class="fl">100000</span>,</span>
<span>  inc_rate <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                               left        right extreme_right</span></span>
<span><span class="co">## Initial parts           0.34161097    0.4756646     0.1827245</span></span>
<span><span class="co">## New parts               0.34061774    0.4693200     0.1900622</span></span>
<span><span class="co">## Elasticity             -0.05051647   -0.2317484     0.6977253</span></span>
<span><span class="co">## Variation in %         -0.29074696   -1.3338252     4.0157495</span></span>
<span><span class="co">## Variation in % points  -0.09932235   -0.6344534     0.7337757</span></span>
<span><span class="co">## Variation in units    -99.32234990 -634.4533879   733.7757378</span></span></code></pre>
<p>A <span class="math inline">\(5\%\)</span> increase in the direction
of <code>Age_1839</code> will result in a <span class="math inline">\(0.099\)</span> percentage points decrease in the
<code>left</code> share, a <span class="math inline">\(0.63\)</span>
percentage points decrease in the <code>right</code> proportion, and a
<span class="math inline">\(0.73\)</span> percentage points increase in
the <code>extreme_right</code> share. In units these changes correspond
respectively to a decrease of <span class="math inline">\(99\)</span>
votes for the <code>left</code> parties, a decrease of <span class="math inline">\(634\)</span> votes for the <code>right</code>
parties and an increase of <span class="math inline">\(733\)</span>
votes for the <code>extreme_right</code> share. It is easy to check that
the sum of these changes is zero.</p>
</div>
<div class="section level6">
<h6 id="infinitesimal-increment-general-direction-1">Infinitesimal increment: General direction<a class="anchor" aria-label="anchor" href="#infinitesimal-increment-general-direction-1"></a>
</h6>
<p>For a general direction <span class="math inline">\((0.45,0.2,0.35)\)</span>, with an increment size
of <span class="math inline">\(0.1\)</span>, we get the following
results.</p>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/VariationTable.html">VariationTable</a></span><span class="op">(</span></span>
<span>  <span class="va">fit_YX_compo</span>,</span>
<span>  Xvar <span class="op">=</span> <span class="st">"AGE"</span>,</span>
<span>  Xdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.45</span>,<span class="fl">0.2</span>,<span class="fl">0.35</span><span class="op">)</span> ,</span>
<span>  inc_size<span class="op">=</span><span class="fl">0.1</span>,</span>
<span>  Ytotal <span class="op">=</span> <span class="fl">100000</span><span class="op">)</span></span>
<span><span class="va">VT</span></span></code></pre></div>
<pre><code><span><span class="co">##                              left         right extreme_right</span></span>
<span><span class="co">## Initial parts           0.3416110     0.4756646     0.1827245</span></span>
<span><span class="co">## New parts               0.3454412     0.4630204     0.1915383</span></span>
<span><span class="co">## Elasticity              0.1121240    -0.2658202     0.4823571</span></span>
<span><span class="co">## Variation in %          1.1212404    -2.6582020     4.8235706</span></span>
<span><span class="co">## Variation in % points   0.3830280    -1.2644125     0.8813844</span></span>
<span><span class="co">## Variation in units    383.0280319 -1264.4124527   881.3844208</span></span></code></pre>
<p>Note that this direction vector will be normalized before being used
within the function, and will later be given as output in the table’s
attributes.</p>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">VT</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $names</span></span>
<span><span class="co">## [1] "left"          "right"         "extreme_right"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $class</span></span>
<span><span class="co">## [1] "data.frame"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $row.names</span></span>
<span><span class="co">## [1] "Initial parts"         "New parts"             "Elasticity"           </span></span>
<span><span class="co">## [4] "Variation in %"        "Variation in % points" "Variation in units"   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`X(0)`</span></span>
<span><span class="co">##    Age_1839    Age_4064  Age_65plus </span></span>
<span><span class="co">## "0.2906800" "0.4380762" "0.2712438" </span></span>
<span><span class="co">## attr(,"class")</span></span>
<span><span class="co">## [1] "acomp"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $`X(h)`</span></span>
<span><span class="co">## [1] 0.3116451 0.4091594 0.2791955</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $Xdir</span></span>
<span><span class="co">## [1] 0.5254862 0.1320255 0.3424884</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inc_size</span></span>
<span><span class="co">## [1] 0.1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $inc_rates</span></span>
<span><span class="co">## [1]  0.07212431 -0.06600860  0.02931571</span></span></code></pre>
<!-- # Implementation details -->
<!-- to find the coordinates of the parameters of the model in the simplex and clr spaces after regression, and then evaluate the impact, to finally interpret it, we constructed a function that retrieves all the information necessary to interpret the compositional regression's results in the simplex or clr spaces, including all the parameters of the regression in the simplex and clr spaces. -->
<!-- It uses an internal function (transformationSummary) to summarize the regression's information. It returns an object of class 'lmSimplex' that contains the lm regression results, along with a list 'trSry', a list that contains the transformationSummary results, a data.frame, where rows correspond to the variables and columns to different information sets related to the transformations involved with each variable. -->
</div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Coenders, G. and Pawlowsky-Glahn, V. (2020). On interpretations of
tests and effect sizes in regression models with a compositional
predictor. SORT-Statistics and Operations Research Transactions, pages
201–220.</p>
<p>Dargel, L., and C. Thomas-Agnan (2023). “Pairwise share-ratio
interpretations of compositional regression models.” TSE working paper
23-1456.</p>
<p>Morais, J., and C. Thomas-Agnan. (2021) “Impact of covariates in
compositional models and simplicial derivatives.” Austrian Journal of
Statistics 50.2 (2021): 1-15.</p>
<p>Muller I, Hron K, Fiserova E, Smahaj J, Cakirpaloglu P, Vancakova J
(2018). Interpretation of Compositional Regression with Application to
Time Budget Analysis.” Austrian Journal of Statistics, 47(2).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lukas Dargel, Christine Thomas.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
